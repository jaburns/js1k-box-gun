<!doctype html>
<html>
  <head>
    <title>JS1k</title>
    <style>
      body,html,iframe{margin:0;padding:0;border:0;width:100%;height:100%}iframe{position:absolute;top:0;left:0;
      padding-top:50px;box-sizing:border-box} header{position:relative;z-index:1;height:47px;padding-top:2px;
      border-bottom:1px solid #000;box-shadow:0 -10px 25px #ccc inset;background-color:#eee} aside,div,h1,p{overflow:
      hidden;white-space:nowrap;text-overflow:ellipsis;text-align:center;font-size:16px;font-weight:inherit;line-height:
      22px;padding:0;margin:0;cursor:default} aside,h1{display:inline} a{color:#000;text-decoration:none;border-bottom:
      1px dashed #000} a:hover{border-bottom:1px solid red} a[href="0"]{text-decoration:line-through;pointer-events:none
      ;border-bottom:0;color:#ccc} .button{float:left;width:40px;height:40px;line-height:40px;text-align:center;padding:
      0;margin:2px 0 0 10px;border:1px solid #888;border-color:#ddd #888 #888 #ddd;font-family:sans-serif;font-size:30px
      ;font-weight:700;cursor:pointer} .button:hover{color:red;border-bottom-color:#888} .r{margin-right:10px}
    </style>
  </head>
  <body>
    <header>
      <div>
        <h1>
          <a href="https://js1k.com">JS1k</a>
        </h1>
        <p></p>
      </div>
      <a href="#" class="button p">&Larr;</a>
      <a href="#" class="button n">&Rarr;</a>
    </header>
    <script type="demo">

// Reversed https://js1k.com/2019-x/details/4130

    for (i in (g)) {
        g[i[0] + i[6]] = g[i];
        console.log(i[0] + i[6], i, g[i]);
    }
    with(g) {
        p = createProgram();

        i = 'attribute vec4 a;void main(){gl_Position=a;}';
        s = createShader(VERTEX_SHADER);
        shaderSource(s, i);
        compileShader(s);
        attachShader(p, s);

        i = 'precision highp float;uniform vec4 _;vec4 s=vec4(.01,.005,0,.05),n=vec4(.7,.35,.2,.43);float i(vec3 z){vec3 i=(z-vec3(sin(z.z*.12)*6.,0,0))*vec3(sin(z.z*.2)*sin(z.z*.6)*sin(z.z*.6)*sin(z.z*.9)*.5+min(sin(z.z*.05)+1.2,.4),min(sin(z.z*.05)+1.3,.5),0);return 1.+min(.2+min(-abs(i.x),min(-abs(i.y),.14+z.y+.03*sin(z.z*.12)))-dot(abs(fract(abs(fract(z*.3)-.5).yzx+z*.6)-.5),n.yyy),sin(i.x/.04+sin(_.z*4.+z.z*9.))*s.y+z.y);}void main(){vec4 m=vec4(gl_FragCoord-_*.5)/_.y;float a=.0,e=clamp(sin(_.z*.2)-.9,.0,.05)*50.+.04*sin(_.z*4.);vec3 y=vec3(0,.6+abs(.05*sin(_.z*4.)),_.z*.9+abs(.02*sin(_.z*4.))),f=y+.5*vec3(-sin(e),-.2,cos(e)),x=y+vec3(.7);y=y+vec3(sin(y.z*.12)*6.,0,0),x+=vec3(sin(x.z*.12)*6.,0,0);vec3 c=normalize(f+vec3(sin(f.z*.12)*6.,0,0)-y),o=normalize(c+(m.x*normalize(vec3(c.z,0,-c.x))+m.y*cross(c,normalize(vec3(c.z,0,-c.x))))/.7);for(int r=0;r<98;r++)if((e=i(c=y+o*(a+=e*.5)))<s.y)break;gl_FragColor=vec4((-c.y<.98?n.xyz:n.ywy/.8)*min(_.z*.2,1.)*(dot(normalize(vec3(i(c+s.xzz)-e,i(c+s.zyz)-e,i(c+s.zzy)-e)),normalize(x-=c))+.3)*min(2.6/dot(normalize(x),x),1.5)*min(2.6/dot(normalize(x),x),1.5)+s.zwz*sin(_.z*4.*.01),1);}';
        s = createShader(FRAGMENT_SHADER);
        shaderSource(s, i);
        compileShader(s);
        attachShader(p, s);
        
        vertexAttribPointer(
            linkProgram(p),
            2,
            BYTE,
            enableVertexAttribArray(useProgram(p)),
            bindBuffer(x = ARRAY_BUFFER, createBuffer()),
            bufferData(x, Int8Array.of(2, 2, 2, -4, -4, 2), x + 82) // ARRAY_BUFFER + 82 = STATIC_DRAW
        );

        i = new Date / 1e3;
        f = s => {
            drawArrays(
                TRIANGLES,
                uniform4f(getUniformLocation(p, '_'), a.width, a.height, new Date / 1e3 - i, requestAnimationFrame(f)),
                3
            );
        }
        f()
    }

    </script>
    <script>
      (function(){var m=document,b=m.getElementsByTagName("header")[0],h=b.firstChild,n=m.getElementsByClassName("p")[0],f=m
      .getElementsByClassName("n")[0];b.insertBefore(n,h);b.insertBefore(f,h);b.appendChild(m.getElementsByTagName("p")[0])}
      )();(function reload(){function h(a){g.body.removeChild(k);d.parentElement.removeChild(d);t=c=d=k=null;reload(a)}var
        B=T_CANVAS_SHIM=true,
        N=T_WEBGL=true,
        F=T_MAX_WIDTH=0,
        P=T_MAX_HEIGHT=0,
        U=T_LOCK_RATIO=false,
        Q=T_CENTER_CANVAS=false,
        V=T_RELOAD_ONORIENTATIONCHANGE=false,
      g=document,t=g.getElementsByTagName("header")[0],k=g.createElement("iframe");g.body.appendChild(k);var a=k.contentWindow
      ,c=k.contentDocument;c.open();c.close();c.write('<!doctype html><html style="margin: 0; padding: 0; border: 0;'+(B?" w"+
      "idth: 100%; height: 100%;":"")+'"><head><meta charset="utf-8"><body style="margin: 0; padding: 0; border: 0;'+(B?" wi"+
      "dth: 100%; height: 100%;":"")+'">'+(B?'<canvas style="display: block;'+(Q?" margin: auto;":"")+'"></canvas>':"")+"");if
      (B){var e=c.getElementsByTagName("canvas")[0],q=e.style;c.body.clientWidth;var l=Math.max(Math.min(F||innerWidth,
      innerWidth),1),r=Math.max(Math.min(P||innerHeight-50,innerHeight-50),1);(l<F||r<P)&&U&&(l<F?r=l/F*P:l=r/P*F);q.width=(e.
      width=l)+"px";q.height=(e.height=r)+"px"}V&&(onorientationchange=h);a.AudioContext=a.AudioContext||a.webkitAudioContext;
      a.requestAnimationFrame=a.requestAnimationFrame||a.mozRequestAnimationFrame||a.webkitRequestAnimationFrame||a.
      msRequestAnimationFrame||function(b){a.setTimeout(b,1E3/30)};B&&(e.requestPointerLock=e.requestPointerLock||e.
      mozRequestPointerLock||e.webkitRequestPointerLock);c.body.requestPointerLock=c.body.requestPointerLock||c.body.
      mozRequestPointerLock||c.body.webkitRequestPointerLock;var nav=a.navigator;nav.getUserMedia=nav.getUserMedia||N.
      webkitGetUserMedia||nav.mozGetUserMedia||nav.msGetUserMedia;a.OscillatorNode&&a.OscillatorNode.prototype&&(a
      .OscillatorNode.prototype.start=a.OscillatorNode.prototype.start||a.OscillatorNode.prototype.noteOn,a.OscillatorNode.
      prototype.stop=a.OscillatorNode.prototype.stop||a.OscillatorNode.prototype.noteOff);B&&(a.a=e);a.b=c.body;a.d=c;B&&(N||(
      a.c=e.getContext("2d")),N&&(a.g=function(){a.onorientationchange=a.onresize=null;try{var b={antialias:!0,stencil:!0},d=e
      .getContext("webgl",b)||e.getContext("experimental-webgl",b);a.__glExts="OES_texture_float OES_texture_float_linear OE"+
      "S_standard_derivatives EXT_texture_filter_anisotropic MOZ_EXT_texture_filter_anisotropic WEBKIT_EXT_texture_filter_an"+
      "isotropic WEBGL_compressed_texture_s3tc MOZ_WEBGL_compressed_texture_s3tc WEBKIT_WEBGL_compressed_texture_s3tc".split(
      " ").map(function(a){return d.getExtension(a)})}catch(f){throw c.body.innerHTML="WebGL not supported.",a.a=a.b=a.c=a.d=
      null,f;}return d}()));B=c.createElement("script");B.textContent=g.querySelector('script[type="demo"]').textContent;c.
      body.appendChild(B);c.close();k.contentWindow.focus();B=g.getElementsByTagName("div")[0];window.reload=h;var d=g.
      createElement("div");d.innerHTML="&#8635;";d.className="button r";d.title="restart just the demo (local, without remot"+
      "e fetch)";d.onclick=h;t.insertBefore(d,B)})();
    </script>
  </body>
</html>
